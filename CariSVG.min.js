/*
CariSVG, a SVG library for interaction
http://ybochatay.fr

Copyright 2011, Yannick Bochatay

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
(function(){var l=function(a,c){for(var b in c)c.hasOwnProperty(b)&&a[b]===void 0&&(a[b]=c[b]);return a},j=function(a,c){for(var b in c)if(c.hasOwnProperty(b))try{a[b]===void 0&&(Object.defineProperty?Object.defineProperty(a,b,{get:c[b]}):a[b].__defineGetter__&&a[b].__defineGetter__(b,c[b]))}catch(d){}return a},f={Function:{bind:function(a){var c=Array.prototype.slice,b=Array.prototype.concat,d=c.call(arguments,1),h=this;return function(){return h.apply(a,b.call(d,c.call(arguments,0)))}}},Array:{remove:function(a){return this.splice(this.indexOf(a), 1)},rand:function(){return this[Math.rand(0,this.length-1)]}},String:{forEach:function(a){Array.prototype.forEach.call(this,a);return this}},NodeList:{forEach:function(a){Array.prototype.forEach.call(this,a);return this}},SVGMatrix:{getScaleX:function(){return Math.sqrt(Math.pow(this.a,2)+Math.pow(this.b,2))},getScaleY:function(){return Math.sqrt(Math.pow(this.c,2)+Math.pow(this.d,2))},getAngle:function(){return Math.atan2(this.b,this.a)*180/Math.PI},getX:function(){return this.e},getY:function(){return this.f}, toAttr:function(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}},SVGSVGElement:{NS:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",newElmt:function(a,c){if(a=="CariCurve"&&document.createCariCurve)return document.createCariCurve(c);var b=document.createElementNS(this.NS,a);b.attr(c);return b},addElmt:function(a,c){var b=this.newElmt(a,c);this.appendChild(b);return b},point:function(a,c){var b=this.createSVGPoint();b.x=a;b.y=c;return b},css:function(a, c){return window.SVGElement.prototype.css.call(this,a,c)},cssInt:function(a){return window.SVGElement.prototype.cssInt.call(this,a)},getSVG:function(){return this}},SVGElement:{NS:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",getSVG:function(){var a=function(b){do b=b.parentNode;while(b&&b.nodeName.toLowerCase()!="svg");return b};try{return this.ownerSVGElement?this.ownerSVGElement:a(this)}catch(c){return a(this)}},getMtx:function(){var a=this.getAttribute("transform"),c=[],b= this.getSVG().createSVGMatrix(),c=!a||a.indexOf("matrix")===-1?[1,0,0,1,0,0]:/matrix\((.+)\)/.exec(a)[1].split(/, *| /);b.a=c[0];b.b=c[1];b.c=c[2];b.d=c[3];b.e=c[4];b.f=c[5];return b},setMtx:function(a){this.setAttribute("transform",a.toAttr());return this},attr:function(a,c){if(typeof a==="string")if(c)this.setAttribute(a,c);else return this.getAttribute(a);else if(typeof a==="object")for(var b in a)a.hasOwnProperty(b)&&(typeof a[b]==="object"&&b==="style"?this.css(a[b]):this.attr(b,a[b]));return this}, remove:function(){this.parentNode&&this.parentNode.removeChild(this);return this},newElmt:function(a,c){if(a=="CariCurve"&&document.createCariCurve)return document.createCariCurve(c);var b=document.createElementNS(this.NS,a);b.attr(c);return b},addElmt:function(a,c){var b=this.newElmt(a,c);this.appendChild(b);return b},getShift:function(a,c){a=a||a===0?a:"center";c=c||c===0?c:"center";if(typeof a=="number"&&typeof c=="number")return{x:a,y:c};var b=this.getBBox(),d,h;switch(a){case "left":d=0;break; case "right":d=b.width;break;default:d=b.width/2}switch(c){case "top":h=0;break;case "bottom":h=b.height;break;default:h=b.height/2}return this.getSVG().point(b.x+d,b.y+h)},css:function(a,c){if(typeof a=="object"){for(var b in a)a.hasOwnProperty(b)&&this.css(b,a[b]);return this}b=a.replace(/-[a-z]/,function(b){return b.substr(1).toUpperCase()});var d=a.replace(/[A-Z]/,function(b){return"-"+b.toLowerCase()});if(c!==void 0){this.getAttribute&&this.setAttribute(d,c);if(this.style&&this.style[b]!==void 0){if((b== "width"||b=="height")&&!/px/.test(c))c+="px";this.style[b]=c}return this}else return c=this.style&&this.style[b]?this.style[b]:this.getAttribute&&this.getAttribute(d)?this.getAttribute(d):window.getComputedStyle?window.getComputedStyle(this,null).getPropertyValue(d)||void 0:void 0},cssInt:function(a){a=this.css(a);a=parseInt(a,10);return isNaN(a)?!1:a}}},a={SVGElement:{classList:function(){var a=this;a.getAttribute("class")===null&&a.setAttribute("class","");return{length:a.getAttribute("class").split(/ +/).length, add:function(c){a.getAttribute("class").indexOf(c)==-1&&a.setAttribute("class",a.getAttribute("class")+" "+c)},remove:function(c){var b=RegExp("(^| +)"+c);a.getAttribute("class").indexOf(c)!=-1&&a.setAttribute("class",a.getAttribute("class").replace(b,""))},contains:function(c){return a.getAttribute("class").match(RegExp("(^| +)"+c))?!0:!1},toggle:function(c){a.classList.contains(c)?a.classList.remove(c):a.classList.add(c)}}},transf:function(){var a=this;return{reset:function(){a.setMtx(a.getSVG().createSVGMatrix()); return this},translate:function(c,b){a.setMtx(a.getMtx().translate(c,b));return this},scale:function(c,b,d){b=a.getShift(b,d);a.setMtx(a.getMtx().translate(b.x,b.y).scale(c).translate(-b.x,-b.y));return this},scaleNonUniform:function(c,b,d,h){d=a.getShift(d,h);a.setMtx(a.getMtx().translate(d.x,d.y).scaleNonUniform(c,b).translate(-d.x,-d.y));return this},rotate:function(c,b,d){b=a.getShift(b,d);a.setMtx(a.getMtx().translate(b.x,b.y).rotate(c).translate(-b.x,-b.y));return this}}},text:function(){var a= this;return{add:function(c){a.appendChild(document.createTextNode(c));return a},remove:function(){for(;a.firstChild&&a.firstChild.nodeType==3;)a.removeChild(a.firstChild);return a},change:function(c){this.remove();this.add(c);return a},get:function(){var c="",b=a.firstChild;do c+=b.nodeValue;while((b=b.nextSibling)&&b.nodeType==3);return c}}},link:function(){var a=this;return{set:function(c){a.setAttributeNS(a.XLINK,"href",c);return a},get:function(){return a.getAttributeNS(a.XLINK,"href")}}}}};Math.rand= function(a,c){return Math.floor(Math.random()*(c-a+1))+a};window.getTabFromAnimationStyle=function c(a){switch(a){case "linear":return[0,100];case "drop":return[0,3,10,25,50,100];case "cushion":return[0,50,75,90,97,100];case "swing":return[0,3,10,25,50,75,90,97,100];case "bounce":return[0,10,30,60,120,90,105,100];case "random":return c(["linear","drop","cushion","swing","bounce"].rand());case "full-random":for(var a=[0],d=1;d<5;d++)a.push(Math.rand(a[d-1],a[d-1]+40));a.push(100);return a;default:return[0, 100]}};window.inlineSVG=function(){var a=document.createElement("div");a.innerHTML="<svg/>";return(a.firstChild&&a.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}();if(!Object.defineProperty)Object.defineProperty=function(a,b,d){d.get&&a.__defineGetter__&&a.__defineGetter__(b,d.get);d.set&&a.__defineSetter__&&a.__defineSetter__(b,d.set)};for(var g in f)window[g]&&window[g].prototype&&l(window[g].prototype,f[g]);for(g in a)window[g]&&window[g].prototype&&j(window[g].prototype,a[g])})(); if(window.SVGSVGElement&&window.SVGSVGElement.prototype)window.SVGSVGElement.prototype.cariNavig=function(l){if(this.navig)return l&&this.navig.set(l),this;var j=this,f=j.cssInt("width"),a=j.cssInt("height"),g=j.css("cursor"),i=this,c=function(a){for(var b in a)a.hasOwnProperty(b)&&this.hasOwnProperty(b)&&(this[b]=a[b]);return this},b=function(){var b=j.newElmt("g"),h,c=["switch","defs"],k=[];b.css("width",f);for(b.css("height",a);j.firstChild;)h=j.firstChild,h.parentNode.removeChild(h),c.indexOf(h.tagName)!== -1?k.push(h):b.appendChild(h);j.appendChild(b);k.forEach(function(a){j.appendChild(a)});return b}();this.navig={frame:b,set:function(a){var b=["zoom","mobility","resize","cookie"],c,f;for(f in a)if(a.hasOwnProperty(f)&&b.indexOf(f)!==-1&&(c=a[f]===!1?"off":"on",this[f][c]))this[f][c](a[f]);return this},zoom:{key:!1,step:0.1,set:c,change:function(d){d=d||{};typeof d=="number"&&(d={coef:d});var h=j.cssInt("width"),c=j.cssInt("height"),k=b.getMtx(),g=d.coef,i=d.center||j.point(h/2,c/2).matrixTransform(b.getCTM().inverse()), m=d.animate===!0?{duration:300,step:50,style:"swing"}:typeof d.animate==="object"?d.animate:!1,d=d.callback||!1,n=k.getScaleX();if(k.scale(g).getScaleX()<h/f)c=k.inverse(),k=k.translate(c.getX(),c.getY()).scale(h/(f*n)),!m||!b.cariAnim?b.setMtx(k):(m.to=k,m.originX="left",m.originY="top",b.cariAnim(m));else{k=k.translate(i.x,i.y).scale(g).translate(-i.x,-i.y);g=j.point(0,0).matrixTransform(k.inverse());h=j.point(h,c).matrixTransform(k.inverse());g.x<0&&(k=k.translate(g.x,0));g.y<0&&(k=k.translate(0, g.y));h.x>f&&(k=k.translate(h.x-f,0));h.y>a&&(k=k.translate(0,h.y-a));if(!m||!b.cariAnim)b.setMtx(k),d&&d();else{m.to=k;m.originX="left";m.originY="top";if(d)m.callback=d;b.cariAnim(m)}return this}},mousewheel:function(a){if(!this.key||a[this.key]){a.preventDefault();var c=j.point(a.clientX,a.clientY).matrixTransform(b.getScreenCTM().inverse());this.change({coef:1+this.step*(a.wheelDelta/120||-a.detail/3),center:c})}},on:function(a){a&&this.set(a);this.off();var b=this.mousewheel.bind(this);j.addEventListener("DOMMouseScroll", b,!1);j.addEventListener("mousewheel",b,!1);this.off=function(){j.removeEventListener("DOMMouseScroll",b,!1);j.removeEventListener("mousewheel",b,!1);return this};return this},off:function(){}},mobility:{click:"left",key:!1,cursor:"move",x:!0,y:!0,set:c,start:!1,drag:!1,end:!1,translate:function(d,c){d=d||{};c!==void 0&typeof d==="number"&&typeof c==="number"&&(d={x:d,y:c});var e=d.x,c=d.y,g=d.animate===!0?{duration:300,step:50,style:"swing"}:typeof d.animate==="object"?d.animate:!1,i=b.getCTM(), q=j.cssInt("width"),m=j.cssInt("height"),e=j.createSVGMatrix().translate(e,c).multiply(i),i=j.point(0,0).matrixTransform(e.inverse()),q=j.point(q,m).matrixTransform(e.inverse());i.x<0&&(e=e.translate(i.x,0));i.y<0&&(e=e.translate(0,i.y));q.x>f&&(e=e.translate(q.x-f,0));q.y>a&&(e=e.translate(0,q.y-a));!g||!b.cariAnim?b.setMtx(e):(g.to=e,g.originX="left",g.originY="top",b.cariAnim(g));return this},mousedown:function(d){var c=this;if(!(d.button==2&&c.click!="right"||d.button!=2&&c.click!="left"||c.key&& !d[c.key])){d.preventDefault();j.style.cursor=c.cursor;var e=b.getCTM(),k=d.clientX,l=d.clientY,q=j.cssInt("width"),m=j.cssInt("height"),n=function(d){var g=c.x?d.clientX-k:0,n=c.y?d.clientY-l:0,g=j.createSVGMatrix().translate(g,n).multiply(e),n=j.point(0,0).matrixTransform(g.inverse()),o=j.point(q,m).matrixTransform(g.inverse());n.x<0&&(g=g.translate(n.x,0));n.y<0&&(g=g.translate(0,n.y));o.x>f&&(g=g.translate(o.x-f,0));o.y>a&&(g=g.translate(0,o.y-a));b.setMtx(g);c.drag&&c.drag.call(i,d)},p=function(){j.removeEventListener("mousemove", n,!1);j.style.cursor=g;window.removeEventListener("mouseup",p,!1);c.end&&c.end.call(i,d)};j.addEventListener("mousemove",n,!1);window.addEventListener("mouseup",p,!1);c.start&&c.start.call(i,d)}},on:function(a){a&&this.set(a);this.off();this.click=="right"&&j.addEventListener("contextmenu",function(a){a.preventDefault()},!1);var b=this.mousedown.bind(this);j.addEventListener("mousedown",b,!1);this.off=function(){j.removeEventListener("mousedown",b,!1);return this};return this},off:function(){}},resize:{click:"left", key:!1,field:!1,x:!0,y:!0,xmin:100,ymin:100,xmax:2E3,ymax:2E3,set:c,keepRatio:!0,keepViewBox:!0,start:!1,drag:!1,end:!1,change:function(a,c){var e=j.cssInt("width"),f=j.cssInt("height"),g=b.getMtx(),i=j.point(0,0).matrixTransform(g.inverse());j.css("width",a);b.css("width",a);this.keepRatio===!0?c=f*a/e:c===void 0&&(c=f);j.css("height",c);b.css("height",c);this.keepViewBox&&(e=g.translate(i.x,i.y).scaleNonUniform(a/e,c/f).translate(-i.x,-i.y),b.setMtx(e));return this},mousedown:function(a){var c= this;if(!(a.button==2&&c.click!="right"||a.button!=2&&c.click!="left"||c.key&&!a[c.key])){a.preventDefault();var e,f;e=c.field&&typeof c.field=="string"?document.querySelector(c.field):c.field||j;f=c.x===!1?"n":c.y===!1?"e":"se";var g=e.css("cursor");e.style.cursor=f+"-resize";var l=a.clientX,m=a.clientY,n=j.cssInt("width"),p=j.cssInt("height"),t=b.getMtx(),u=j.point(0,0).matrixTransform(t.inverse()),s=function(a){var d=a.clientY-m,e=Math.min(c.xmax,Math.max(c.xmin,n+(a.clientX-l))),d=Math.min(c.ymax, Math.max(c.ymin,p+d));c.keepRatio&&(e=d*n/p);c.x===!1&&(e=n);c.y===!1&&(d=p);j.css("width",e);b.css("width",e);j.css("height",d);b.css("height",d);c.keepViewBox&&(e=t.translate(u.x,u.y).scaleNonUniform(e/n,d/p).translate(-u.x,-u.y),b.setMtx(e));c.drag&&c.drag.call(i,a)},o=function(){window.removeEventListener("mousemove",s,!1);e.style.cursor=g;window.removeEventListener("mouseup",o,!1);c.end&&c.end.call(i,a)};window.addEventListener("mousemove",s,!1);window.addEventListener("mouseup",o,!1);c.start&& c.start.call(i,a)}},on:function(a){a&&this.set(a);if(this.x===!1||this.y===!1)this.keepRatio=!1;this.click=="right"&&j.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.off();var b=this.mousedown.bind(this),c;c=this.field&&typeof this.field=="string"?document.querySelector(this.field):this.field||j;c.addEventListener("mousedown",b,!1);this.off=function(){c.removeEventListener("mousedown",b,!1);return this};return this},off:function(){}},cookie:{expire:!1,set:c,on:function(a){if(a)typeof a== "number"?this.expire=a:this.set(a);var c=j.id||"canevasSVG",a=document.cookies.lire(c),e=this,f=function(){var a;e.expire?(a=new Date,a.setDate(a.getDate()+e.expire)):a=!1;var d=j.cssInt("width")+";"+j.cssInt("height")+";"+b.getAttribute("transform");document.cookies.ecrire(c,d,a)};if(a){var g=a.split(";"),a=g[0],i=g[1],g=g[2];j.css("width",a);b.css("width",a);j.css("height",i);b.css("height",i);b.setAttribute("transform",g)}this.off();window.addEventListener("unload",f,!1);this.off=function(){window.removeEventListener("unload", f,!1);document.cookies.effacer(c);return this};return this},off:function(){}}};l&&this.navig.set(l);return this}; document.createCariCurve=function(l){var j=document.createElementNS("http://www.w3.org/2000/svg","svg"),f,a=j.newElmt("g"),g=function(){var b=a.points.list,c=b.length;return c<2?!1:b[0].x===b[c-1].x&&b[0].y===b[c-1].y?!0:!1},i=function(b){var b=b||{},c=b.path||a.path.getAttribute("d"),d=b.mtx||!1,b=b.ctrlPoints?2:6,e=[],f=c.trim().replace(/[A-Z] ?/g,"").split(/, *| /),h=0,g=f.length;for(g<=4&&(b=2);h<g;h+=b)c=j.point(f[h],f[h+1]),d&&(c=c.matrixTransform(d)),c.x=c.x,c.y=c.y,e.push(c);return e},c=function(a){var b, c,d,e,f,h,g,i,k=[],o=a.length-1;for(b=0;b<o;b+=3)c=a[b],e=a[b+1],f=a[b+2],d=a[b+3],h=j.point((c.x+e.x)/2,(c.y+e.y)/2),g=j.point((e.x+f.x)/2,(e.y+f.y)/2),f=j.point((f.x+d.x)/2,(f.y+d.y)/2),e=j.point((h.x+g.x)/2,(h.y+g.y)/2),g=j.point((g.x+f.x)/2,(g.y+f.y)/2),i=j.point((e.x+g.x)/2,(e.y+g.y)/2),b===0&&k.push(c),k.push(h,e,i,g,f,d);return k},b=function(){var b;b=a.points.list;var c=b.length;if(!(c<3)){var d=[],e=g(),f=0,i,k,o,n,m,l,q,s,p,r,t;for(d.push(b[0]);f<c-1;f++)i=f-1,k=f,o=f+1,n=f+2,k===0?i=e? c-2:k:k===c-2&&(n=e?1:o),m=b[k].x,l=b[k].y,k=b[o].x,s=b[o].y,q=m-b[n].x,n=l-b[n].y,p=b[i].x-b[o].x,i=b[i].y-b[o].y,o=Math.abs(m-k),r=Math.abs(l-s),r=Math.sqrt(o*o+r*r),o=Math.sqrt(q*q+n*n),t=Math.sqrt(p*p+i*i),r!==0&&(o=o/r*3,r=t/r*3,m-=p/r,l-=i/r,q=k+q/o,n=s+n/o,d.push(j.point(m,l),j.point(q,n),j.point(k,s)));b=d}e="M"+b[0].x.toFixed(h)+","+b[0].y.toFixed(h)+" ";if(b.length<3)e+="L"+b[1].x.toFixed(h)+","+b[1].y.toFixed(h);else for(c=1;c<b.length-2;c+=3){e+="C";for(d=0;d<=2;d++)e+=b[c+d].x.toFixed(h)+ ","+b[c+d].y.toFixed(h)+" "}a.path.setAttribute("d",e);a.extraPoints.display&&a.extraPoints.show();a.pattern.display&&a.pattern.show();a.textPath.path&&a.path.id&&a.textPath.path.link.set("#"+a.path.id)},d=function(){this.x=parseFloat(this.getAttribute("cx"));this.y=parseFloat(this.getAttribute("cy"));var c=a.points.list,d=this;g()&&c.length>3&&(a.points.magnet.className&&c[0].setAttribute("class",a.points.magnet.className),c[0].setAttribute("r",a.points.radius+2));this.move=function(e){e.stopPropagation(); var h=j.point(e.clientX,e.clientY).matrixTransform(a.getScreenCTM().inverse()),i=c[0],k=c[c.length-1];g()&&d===k&&c.length>3&&!f?(i.setAttribute("cx",h.x),i.x=h.x,i.setAttribute("cy",h.y),i.y=h.y,k.setAttribute("cx",h.x),k.x=h.x,k.setAttribute("cy",h.y),k.y=h.y,b()):(i=d===i?k:i,a.points.magnet.strength&&Math.abs(i.x-h.x)<a.points.magnet.strength&&Math.abs(i.y-h.y)<a.points.magnet.strength&&c.length>3?(d.setAttribute("cx",i.x),d.x=i.x,d.setAttribute("cy",i.y),d.y=i.y,c[0].setAttribute("class",a.points.magnet.className), c[0].setAttribute("r",a.points.radius+2),b()):(d.setAttribute("cx",h.x),d.x=h.x,d.setAttribute("cy",h.y),d.y=h.y,g()||(c[0].setAttribute("class",""),c[0].setAttribute("r",a.points.radius)),b(),a.points.drag&&a.points.drag.call(d,e)))};this.suppress=function(){c.remove(d);d.remove()};this.addEventListener("click",function(a){a.button!==2&&a.stopPropagation()},!1);this.addEventListener("mousedown",function(b){b.button!==2&&(b.preventDefault(),b.stopPropagation(),window.addEventListener("mousemove", d.move,!1),window.addEventListener("mouseup",function z(b){window.removeEventListener("mousemove",d.move,!1);window.removeEventListener("mouseup",z,!1);a.points.end&&a.points.end.call(d,b)},!1),a.points.start&&a.points.start.call(d,b))},!1)},h=2;Object.defineProperty(a,"precision",{get:function(){return h},set:function(a){if(typeof a!=="number")throw a+" is not a number";h=parseInt(Math.max(0,a),10);this.parentNode&&this.autoDraw(this.points.get())}});a.points={list:[],nbmin:!1,magnet:{strength:5}, get:function(b){b=b||{};return i({mtx:b.realXY?!1:a.getMtx(),ctrlPoints:b.ctrlPoints})},multiply:function(b){if(b!==void 0){for(var d=0;d<b;d++)this.multiply();return this}b=this.nbmin;d=i({ctrlPoints:!0});a.autoDraw({points:c(d),ctrlPoints:!0,mtx:a.getAttribute("transform")});this.nbmin=b;return this},divide:function(b){if(this.nbmin===this.list.length)return this;var c,d=this.nbmin,e=[];if(b!==void 0){for(c=0;c<b;c++)this.divide();return this}for(c=0,b=this.list.length;c<b;c+=2)e.push(this.list[c]); a.autoDraw({points:e,mtx:a.getAttribute("transform")});this.nbmin=d;return this},inverse:function(){a.autoDraw({points:i().reverse(),mtx:a.getAttribute("transform")});return this}};var e=3;Object.defineProperty(a.points,"radius",{get:function(){return e},set:function(a){if(typeof a!=="number")throw a+" is not a number";e=parseInt(Math.max(0,a),10);this.list.forEach(function(b){b.getAttribute&&b.attr("r",a)})}});var k=!0;Object.defineProperty(a.points,"display",{get:function(){return k},set:function(b){if(typeof b!== "boolean")throw b+" is not a boolean";if(b&&!k){var c=this;this.list.forEach(function(b,e){b=j.newElmt("circle",{cx:b.x.toFixed(h),cy:b.y.toFixed(h),r:a.points.radius});a.appendChild(b);d.call(b);c.list[e]=b})}else!b&&k&&this.list.forEach(function(a,b){this.list[b]=j.point(parseFloat(a.attr("x")),parseFloat(a.attr("y")));a.remove()});k=b}});var r="closingPoint";Object.defineProperty(a.points.magnet,"className",{get:function(){return r},set:function(b){if(typeof b!=="string")throw b+" is not a string"; g()&&(a.points.list[0].classList.remove(r),a.points.list[0].classList.add(b));r=b}});a.extraPoints={nb:1,list:[],set:function(a){for(var b in a)a.hasOwnProperty(b)&&this.hasOwnProperty(b)&&(this[b]=a[b])},multiply:function(a){this.nb+=a!==void 0?a:1;this.display&&this.show()},divide:function(a){this.nb-=a!==void 0&&this.nb-a>=0?a:0;this.display&&this.show()},hide:function(){for(;this.list[0];)this.list[0].remove(),this.list.shift()},show:function(){if(!(a.points.list.length<3)){this.hide();var b= Math.pow(2,this.nb)*3,d=i({ctrlPoints:!0}),e,f,g,k;for(f=0;f<this.nb;)d=c(d),f++;for(f=0,k=d.length;f<k;f+=3)f%b!==0&&(e=d[f].x.toFixed(h),g=d[f].y.toFixed(h),e=j.newElmt("circle",{cx:e,cy:g,r:this.radius,"class":this.className}),a.appendChild(e),this.list.push(e))}}};var q=2;Object.defineProperty(a.extraPoints,"radius",{get:function(){return q},set:function(a){if(typeof a!=="number")throw a+" is not a number";q=parseInt(Math.max(0,a),10);this.list.forEach(function(b){b.getAttribute&&b.attr("r",a)})}}); var m="extraPoint";Object.defineProperty(a.extraPoints,"className",{get:function(){return m},set:function(a){if(typeof a!=="string")throw a+" is not a string";m=a;this.list.forEach(function(b){b.getAttribute&&b.classList.add(a)})}});var n=!1;Object.defineProperty(a.extraPoints,"display",{get:function(){return n},set:function(a){if(typeof a!=="boolean")throw a+" is not a boolean";a&&!n?this.show():!a&&n&&this.hide();n=a}});a.pattern={nb:1,id:!1,extremities:!0,list:[],set:function(a){for(var b in a)a.hasOwnProperty(b)&& this.hasOwnProperty(b)&&(this[b]=a[b])},multiply:function(a){this.nb+=a!==void 0?a:1;this.display&&this.show()},divide:function(a){this.nb-=a!==void 0&&this.nb-a>=0?a:0;this.display&&this.show()},hide:function(){for(;this.list[0];)this.list[0].remove(),this.list.shift()},show:function(){if(!(a.points.list.length<3)){this.hide();var b=i({ctrlPoints:!0}),d,e,f,g;for(e=0;e<this.nb-1;)b=c(b),e++;for(e=0,g=b.length;e<g;e+=3)if(this.extremities||!(e===0||e===g-1))d=b[e].x.toFixed(h),f=b[e].y.toFixed(h), d=j.newElmt("use",{x:d,y:f}),a.insertBefore(d,a.path.nextSibling),d.link.set(this.id),this.list.push(d),f=e+(e<g-1?1:-1),f=90-Math.atan2(b[f].x-b[e].x,b[f].y-b[e].y)*180/Math.PI,e===g-1&&(f+=180),d.transf.rotate(f,b[e].x,b[e].y)}}};var p=!1;Object.defineProperty(a.pattern,"display",{get:function(){return p},set:function(a){if(typeof a!=="boolean")throw a+" is not a boolean";a&&!p?this.show():!a&&p&&this.hide();p=a}});var t=!1;Object.defineProperty(a.pattern,"id",{get:function(){return t},set:function(a){if(typeof a!== "string")throw a+" is not a string";this.list.forEach(function(b){b.link.set(a)});t=a}});var u=!0;Object.defineProperty(a.pattern,"extremities",{get:function(){return u},set:function(a){if(typeof a!=="boolean")throw a+" is not a boolean";u=a;this.display&&this.show()}});var s={path:a.appendChild(j.newElmt("path")),set:function(a,b){var b=b||this,c;for(c in a)a.hasOwnProperty(c)&&(typeof a[c]=="object"&&a[c]!==null&&!(a[c]instanceof Array)?this.set(a[c],b[c]):b.hasOwnProperty(c)&&(b[c]=a[c]));return b}, textPath:{node:null,path:null,options:{startOffset:0,method:"stretch",spacing:"auto"},create:function(){if(!a.path.id)a.path.id="curve"+Math.rand(0,1E3);this.node=j.newElmt("text");a.insertBefore(this.node,a.firstChild);this.path=this.node.addElmt("textPath",this.options).link.set("#"+a.path.id).text.add("")},add:function(a,b){if(!this.node){if(b)this.options=b;this.create()}this.path.text.add(a);return this},change:function(a){this.node||this.create();this.path.text.change(a);return this},get:function(){return this.path&& this.path.text.get()},remove:function(){if(this.node)this.node.remove(),this.path=this.node=null}},draw:function(c){c.parent&&c.parent.appendChild(a);if(a.parentNode){if(a.points.display===!1)a.points.display=!0;var e=c.event||c,i=c.callback||!1,j,k={},o=a.parentNode,n=a.getSVG(),m=function(b){k.move&&n.removeEventListener("mousemove",k.move,!1);b=n.point(b.clientX,b.clientY).matrixTransform(o.getScreenCTM().inverse());k=n.newElmt("circle",{cx:b.x.toFixed(h),cy:b.y.toFixed(h),r:a.points.radius}); a.appendChild(k);a.points.list.push(k);d.call(k);n.addEventListener("mousemove",k.move,!1)},l=function(){n.removeEventListener("mousemove",k.move,!1);o.removeEventListener("click",j,!0);f=!1;a.points.nbmin=a.points.list.length;i&&i()};j=function(b){f!==!1&&(g()?a.points.list.length>2&&l():b.detail===2&&a.points.list.length>=3?(a.points.list[a.points.list.length-1].remove(),a.points.list.pop(),l()):m(b))};f=!0;m(e);m(e);b();o.addEventListener("click",j,!0)}else alert("You must append the CariCurve to the DOM first")}, autoDraw:function(c){typeof c==="string"?c={path:c}:c instanceof Array&&(c={points:c});var e=c.path||!1,f=c.points||!1,h=c.ctrlPoints||!1,c=c.mtx||!1,g=h?3:1,k;e&&!f&&(f=i({path:e,ctrlPoints:h}));f.length<3&&(g=1);this.reset();for(h=0,k=f.length;h<k;h+=g)e=this.points.display?j.newElmt("circle",{cx:f[h].x,cy:f[h].y,r:this.points.radius}):j.point(f[h].x,f[h].y),this.points.list.push(e),this.points.display&&(a.appendChild(e),d.call(e));this.points.nbmin=this.points.list.length;b();c&&a.setAttribute("transform", c)},random:function(b,c,d,e,f){var b=b||4,h=a.parentNode||!1,g=h&&h.tagName.toLowerCase();if(h===!1&&(d===void 0||f===void 0))return alert("You must append the CariCurve to the DOM or specify the xmin,xmax,ymin,ymax"),!1;c=c||0;d=d||(g==="svg"?h.cssInt("width"):h.getBBox().width);e=e||0;f=f||(g==="svg"?h.cssInt("height"):h.getBBox().height);h=0;for(g=[];h<b;h++)g.push({x:Math.rand(c,d),y:Math.rand(e,f)});return g},animPath:{duration:1E3,step:20,callback:!1,counter:0,from:!1,to:!1,inProgress:!1,style:[0, 100],loop:!1,way:1,fct:!1,queue:[],indQueue:0,ratio:!1,animate:function(){this.goTo(this.counter);this.counter+=this.way*100*this.step/this.duration;this.counter=Math.min(100,Math.max(this.counter,0))},coef:function(){var a=this.counter*(this.style.length-1)/100,b=Math.min(Math.floor(a),this.style.length-2),c=b+1,d=this.style[b],c=(d-this.style[c])/(b-c);return Math.round(c*a+(d-c*b))},set:function(b){if(typeof b!=="object"||b instanceof Array)b={to:b};if(typeof b.to==="string")b.to=i({path:b.to}); for(var c in b)b.hasOwnProperty(c)&&this.hasOwnProperty(c)&&(this[c]=b[c]);if(!(this.style instanceof Array))this.style=window.getTabFromAnimationStyle(this.style);var d;c=this.to.length;if(!b.from)b.from=a.points.get({ctrlPoints:!1}),this.from=b.from;for(;(d=this.from.length)&&d<c;)a.points.multiply(),this.from=a.points.get({ctrlPoints:!1});this.ratio=c/d;return this},goTo:function(b){this.counter=b=Math.min(100,Math.max(b,0));var c,d,e,f=[],h;h=this.coef();for(c=0;c<this.from.length;c++)d=(this.from[c].x* (100-h)+this.to[Math.floor(this.ratio*c)].x*h)/100,e=(this.from[c].y*(100-h)+this.to[Math.floor(this.ratio*c)].y*h)/100,f.length>0&&d==f[f.length-1].x&&e==f[f.length-1].y||f.push(j.point(d,e));a.autoDraw({points:f,displayPoints:this.counter%100===0&&a.points.display?!0:!1});this.fct&&this.fct.call(a);if(b===100)(b=this.inProgress)&&this.pause(),this.callback&&this.callback.call(a),this.queue[this.indQueue+1]?(this.indQueue++,this.counter=0,this.queue[this.indQueue].from=a.points.get({ctrlPoints:!1}), this.set(this.queue[this.indQueue]),b&&this.play()):this.loop&&(this.stop(),b&&this.play());else if(b===0&&!this.inProgress&&this.queue[this.indQueue-1])this.indQueue--,this.counter=100,this.set(this.queue[this.indQueue]);return this},play:function(){if(!this.inProgress)this.inProgress=window.setInterval(this.animate.bind(this),this.step);return this},pause:function(){this.inProgress&&window.clearInterval(this.inProgress);this.inProgress=!1;return this},stop:function(){this.pause();this.indQueue= this.counter=0;this.queue[0]&&this.set(this.queue[0]);this.goTo(0);return this},clear:function(){this.pause();this.counter=this.indQueue=0;this.queue=[];this.to=[];this.from=[];this.ratio=this.callback=!1;return this},add:function(a){this.queue.length===0&&this.set(a);this.queue.push(a);return this},go:function(a){this.inProgress||this.clear();this.add(a);this.inProgress||this.play();return this}},reset:function(){this.path.setAttribute("d","M0,0");a.setAttribute("transform","matrix(1,0,0,1,0,0)"); for(var b;b=this.points.list[0];)b.suppress?b.suppress():this.points.list.remove(b);this.points.nbmin=!1},remove:function(){this.reset();this.animPath.clear();return a.parentNode&&a.parentNode.removeChild(a)}},o;for(o in s)s.hasOwnProperty(o)&&(a[o]=s[o]);l&&a.set(l);return a}; if(window.SVGElement&&window.SVGElement.prototype)window.SVGElement.prototype.cariDrag=function(l){if(this.drag)return l&&this.drag.set(l),this;var l=l||{},j=l.evt||!1,f=this,a=f.css("cursor"),g=function(a){for(var b in a)a.hasOwnProperty(b)&&this.hasOwnProperty(b)?this[b]=a[b]:b=="evt"&&(j=a[b])},i=function(a){if(a===void 0||a==="center")return 0.5;else if(a==="top"||a==="left")return 0;else if(a==="bottom"||a.indexOf("right")!==-1)return 1};this.drag={set:function(a){var b=["mobility","resize", "rotation"],d,h;for(h in a)if(a.hasOwnProperty(h)&&b.indexOf(h)!=-1&&(d=a[h]===!1?"off":"on",f.drag[h][d]))f.drag[h][d](a[h]);return this},mobility:{click:"left",key:!1,field:!1,className:!1,x:!0,y:!0,xmin:!1,ymin:!1,xmax:!1,ymax:!1,start:!1,drag:!1,end:!1,magnet:{list:[],strength:10,x:"center",y:"center",className:"magnet",require:!1,callback:!1},mousedown:function(c){var b,d,h,e=this,g;typeof e.field=="string"?g=document.querySelectorAll(g):e.field instanceof Array?g=e.field:typeof e.field=="object"&& !(e.field instanceof NodeList)?g=[e.field]:e.field||(g=[f]);if(!(c.button==2&&e.click!="right"||c.button!=2&&e.click!="left"||e.key&&!c[e.key])){c.preventDefault();h=e.x&&e.y?"move":e.x?"e-resize":"n-resize";g.forEach(function(b){b.style.cursorInit=b===f?a:b.css("cursor");b.style.cursor=h});e.className&&f.classList.add(e.className);var j=f.getCTM(),l=f.getMtx(),m=f.getSVG(),n=f.parentNode==m?f.parentNode.createSVGMatrix():f.parentNode.getCTM().inverse(),p=f.parentNode==m?f.parentNode.createSVGMatrix(): f.parentNode.getScreenCTM().inverse(),t=c.clientX,u=c.clientY,s;if(e.magnet){if(e.magnet.list)if(typeof e.magnet.list=="string")s=document.querySelectorAll(e.magnet.list);else if(e.magnet.list instanceof Array||e.magnet.list instanceof NodeList)s=e.magnet.list;if(s&&s.length>0){var o=f.parentNode.getScreenCTM(),w=i(e.magnet.x),x=i(e.magnet.y),v=f.getBoundingClientRect();b=v.left+v.width*w;d=v.top+v.height*x;s.forEach(function(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect();a.left=b.left+ b.width*w;a.top=b.top+b.height*x}else b=m.point(a.x,a.y).matrixTransform(o),a.left=b.x,a.top=b.y})}}var y=function(a){var c=e.x?a.clientX-t:0,h=e.y?a.clientY-u:0;if(e.magnet){e.magnet.ok=!1;e.magnet.className&&f.classList.remove(e.magnet.className);for(var g,i=0,k=s.length;i<k;i++)if(g=s[i],Math.abs(a.clientX-t+b-g.left)<e.magnet.strength&&Math.abs(a.clientY-u+d-g.top)<e.magnet.strength){c=g.left-b;h=g.top-d;f.classList.add(e.magnet.className);e.magnet.ok=g;break}}c=n.translate(c,h).multiply(j);f.setMtx(c); e.bornes&&(g=f.getBoundingClientRect(),h=m.point(g.left,g.top).matrixTransform(p),g=m.point(g.right,g.bottom).matrixTransform(p),k=i=0,e.xmin!==!1&&h.x<e.xmin&&(i=e.xmin-h.x),e.ymin!==!1&&h.y<e.ymin&&(k=e.ymin-h.y),e.xmax!==!1&&g.x>e.xmax&&(i=e.xmax-g.x),e.ymax!==!1&&g.y>e.ymax&&(k=e.ymax-g.y),c=m.createSVGMatrix().translate(i,k).multiply(c),f.setMtx(c));e.drag&&e.drag.call(f,a)};m.addEventListener("mousemove",y,!1);window.addEventListener("mouseup",function A(a){e.magnet&&(e.magnet.className&&f.classList.remove(e.magnet.className), e.magnet.ok?e.magnet.callback&&e.magnet.callback.call(f,e.magnet.ok):e.magnet.require&&(f.cariAnim?f.cariAnim({to:l,duration:300,style:"swing"}):f.setMtx(l)));e.className&&f.classList.remove(e.className);g.forEach(function(a){a.style.cursor=a.style.cursorInit});m.removeEventListener("mousemove",y,!1);window.removeEventListener("mouseup",A,!1);e.end&&e.end.call(f,a)},!1);e.start&&e.start.call(f,c)}},set:g,on:function(a){a&&this.set(a);a=this;this.bornes=this.xmin!==!1||this.ymin!==!1||this.xmax!== !1||this.ymax!==!1?!0:!1;this.off();var b=this.mousedown.bind(this),d;typeof this.field=="string"?d=document.querySelectorAll(d):this.field instanceof Array?d=this.field:typeof this.field=="object"&&!(this.field instanceof NodeList)?d=[this.field]:this.field||(d=[f]);d.forEach(function(d){a.click=="right"&&d.addEventListener("contextmenu",function(a){a.preventDefault()},!1);d.addEventListener("mousedown",b,!1)});this.off=function(){d.forEach(function(a){a.removeEventListener("mousedown",b,!1)});return this}; j&&b(j);return this},off:function(){}},resize:{click:"right",key:!1,field:!1,className:!1,x:!0,y:!0,magnet:!1,xmin:5,ymin:5,xmax:3E3,ymax:3E3,originX:"center",originY:"center",inverse:!1,keepRatio:!0,start:!1,drag:!1,end:!1,mousedown:function(c){var b=this,d;typeof this.field=="string"?d=document.querySelectorAll(d):this.field instanceof Array?d=this.field:typeof this.field=="object"&&!(this.field instanceof NodeList)?d=[this.field]:this.field||(d=[f]);if(!(c.button==2&&b.click!="right"||c.button!= 2&&b.click!="left"||b.key&&!c[b.key])){c.preventDefault();var g;g=b.x===!1?"n":b.y===!1?"e":"se";d.forEach(function(b){b.style.cursorInit=b===f?a:b.css("cursor");b.style.cursor=g+"-resize"});b.className&&f.classList.add(b.className);var e=f.getShift(b.originX,b.originY);if(b.x===!1)e.x=0;else if(b.y===!1)e.y=0;var i=f.getMtx(),j=f.getBoundingClientRect(),l=j.width,m=j.height,n=c.clientX,p=c.clientY,t=f.getBBox(),u=function(a){var c=1+(b.originX=="center"?2:1)*(a.clientX-n)/l,d=1+(b.originY=="center"? 2:1)*(a.clientY-p)/m;b.x===!1?c=1:b.y===!1?d=1:b.keepRatio&&(c=d);var c=i.translate(e.x,e.y).scaleNonUniform(c,d),d=c.getScaleX(),g=c.getScaleY(),h=t.width*d,j=t.height*g,r;if(b.inverse||!(c.a/Math.abs(c.a)!=i.a/Math.abs(i.a)||c.d/Math.abs(c.d)!=i.d/Math.abs(i.d))){if(h<b.xmin||h>b.xmax)if(b.keepRatio)return;else try{r=c.inverse(),c=c.scaleNonUniform(r.getScaleX(),1).scaleNonUniform((h<b.xmin?b.xmin:b.xmax)/t.width,1)}catch(u){}if(j<b.ymin||j>b.ymax)if(b.keepRatio)return;else try{r=c.inverse(),c= c.scaleNonUniform(1,r.getScaleY()).scaleNonUniform(1,(j<b.ymin?b.ymin:b.ymax)/t.height)}catch(B){}b.magnet&&(b.keepRatio?Math.abs(1-g)<b.magnet&&(c=c.scale(c.inverse().getScaleY())):(Math.abs(1-d)<b.magnet&&(c=c.scaleNonUniform(c.inverse().getScaleX(),1)),Math.abs(1-g)<b.magnet&&(c=c.scaleNonUniform(1,c.inverse().getScaleY()))));c=c.translate(-e.x,-e.y);f.setMtx(c);b.drag&&b.drag.call(f,a)}};window.addEventListener("mousemove",u,!1);window.addEventListener("mouseup",function o(){b.className&&f.classList.remove(b.className); d.forEach(function(a){a.style.cursor=a.style.cursorInit});window.removeEventListener("mousemove",u,!1);window.removeEventListener("mouseup",o,!1);b.end&&b.end.call(f,c)},!1);b.start&&b.start.call(f,c)}},set:g,on:function(a){a&&this.set(a);a=this;if(this.x===!1||this.y===!1)this.keepRatio=!1;this.off();var b=this.mousedown.bind(this),d;typeof this.field=="string"?d=document.querySelectorAll(d):this.field instanceof Array?d=this.field:typeof this.field=="object"&&!(this.field instanceof NodeList)?d= [this.field]:this.field||(d=[f]);d.forEach(function(d){a.click=="right"&&d.addEventListener("contextmenu",function(a){a.preventDefault()},!1);d.addEventListener("mousedown",b,!1)});this.off=function(){d.forEach(function(a){a.removeEventListener("mousedown",b,!1)});return this};j&&b(j);return this},off:function(){}},rotation:{click:"left",key:"shiftKey",originX:"center",originY:"center",className:!1,field:!1,start:!1,drag:!1,end:!1,mousedown:function(c){var b=this,d;typeof this.field=="string"?d=document.querySelectorAll(d): this.field instanceof Array?d=this.field:typeof this.field=="object"&&!(this.field instanceof NodeList)?d=[this.field]:this.field||(d=[f]);if(!(c.button==2&&b.click!="right"||c.button!=2&&b.click!="left"||b.key&&!c[b.key])){c.preventDefault();d.forEach(function(b){b.style.cursorInit=b===f?a:b.css("cursor");b.style.cursor="n-resize"});b.className&&f.classList.add(b.className);var g=f.getMtx(),e=f.getShift(b.originX,b.originY),i=c.clientY,j=function(a){f.setMtx(g.translate(e.x,e.y).rotate(a.clientY- i).translate(-e.x,-e.y));b.drag&&b.drag.call(f,a)};window.addEventListener("mousemove",j,!1);window.addEventListener("mouseup",function m(){b.className&&f.classList.remove(b.className);d.forEach(function(a){a.style.cursor=a.style.cursorInit});window.removeEventListener("mousemove",j,!1);window.removeEventListener("mouseup",m,!1);b.end&&b.end.call(f,c)},!1);b.start&&b.start.call(f,c)}},set:g,on:function(a){a&&this.set(a);a=this;this.off();var b=this.mousedown.bind(this),d;typeof this.field=="string"? d=document.querySelectorAll(d):this.field instanceof Array?d=this.field:typeof this.field=="object"&&!(this.field instanceof NodeList)?d=[this.field]:this.field||(d=[f]);d.forEach(function(d){a.click=="right"&&d.addEventListener("contextmenu",function(a){a.preventDefault()},!1);d.addEventListener("mousedown",b,!1)});this.off=function(){d.forEach(function(a){a.removeEventListener("mousedown",b,!1)});return this};j&&b(j);return this},off:function(){}}};l&&this.drag.set(l);return this}; if(window.SVGElement&&window.SVGElement.prototype)window.SVGElement.prototype.cariAnim=function(l){if(this.anim)return l&&this.anim.go(l),this;var j=this.getSVG(),f=this;this.anim={duration:1E3,step:20,callback:!1,fct:!1,counter:0,inProgress:!1,style:[0,100],originX:"center",originY:"center",loop:!1,way:1,from:!1,to:!1,queue:[],indQueue:0,decalage:!1,animate:function(){this.goTo(this.counter);this.counter+=this.way*100*this.step/this.duration;this.counter=Math.min(100,Math.max(this.counter,0))},decomposeMtx:function(a){return{scaleX:a.getScaleX(), scaleY:a.getScaleY(),rotate:a.getAngle(),translateX:a.getX(),translateY:a.getY()}},coef:function(){var a=this.counter*(this.style.length-1)/100,f=Math.min(Math.floor(a),this.style.length-2),i=f+1,c=this.style[f],i=(c-this.style[i])/(f-i);return Math.round(i*a+(c-i*f))},set:function(a){a=a||{};a.to||(a={to:a});for(var g in a)a.hasOwnProperty(g)&&this.hasOwnProperty(g)&&(this[g]=a[g]);this.decalage=f.getShift(this.originX,this.originY);if(!a.from){if(this.queue.length>0&&this.queue[this.indQueue-1])a.from= this.queue[this.indQueue-1].to;else{g=f.getMtx();var i=g.inverse();g=j.createSVGMatrix().translate(this.decalage.x,this.decalage.y).scaleNonUniform(g.getScaleX(),g.getScaleY()).rotate(g.getAngle()).translate(-this.decalage.x,-this.decalage.y).scaleNonUniform(i.getScaleX(),i.getScaleY()).rotate(i.getAngle()).inverse().multiply(g);a.from=this.decomposeMtx(g)}this.from=a.from}if(!(this.style instanceof Array))this.style=window.getTabFromAnimationStyle(this.style);a.to=a.to.constructor==SVGMatrix?this.decomposeMtx(a.to): {scaleX:a.to.scaleX!==void 0?a.to.scaleX:a.to.scale!==void 0?a.to.scale:this.from.scaleX,scaleY:a.to.scaleY!==void 0?a.to.scaleY:a.to.scale!==void 0?a.to.scale:this.from.scaleY,rotate:a.to.rotate!==void 0?a.to.rotate:this.from.rotate,translateX:a.to.translateX!==void 0?a.to.translateX:this.from.translateX,translateY:a.to.translateY!==void 0?a.to.translateY:this.from.translateY};this.to=a.to;return this},goTo:function(a){this.counter=a=Math.min(100,Math.max(a,0));var g=this.coef(),i={},c,b,d,h=["scaleX", "scaleY","rotate","translateX","translateY"];for(c=0,b=h.length;c<b;c++)d=h[c],i[d]=(this.from[d]*(100-g)+this.to[d]*g)/100;g=j.createSVGMatrix().translate(this.decalage.x,this.decalage.y).translate(i.translateX,i.translateY).rotate(i.rotate).scaleNonUniform(i.scaleX,i.scaleY).translate(-this.decalage.x,-this.decalage.y);f.setMtx(g);this.fct&&this.fct.call(f);if(a===100)(a=this.inProgress)&&this.pause(),this.callback&&this.callback.call(f),this.queue[this.indQueue+1]?(this.indQueue++,this.counter= 0,this.set(this.queue[this.indQueue]),a&&this.play()):this.loop&&(this.stop(),this.play());else if(a===0&&!this.inProgress&&this.queue[this.indQueue-1])this.indQueue--,this.counter=100,this.set(this.queue[this.indQueue]);return this},play:function(){if(!this.inProgress)this.inProgress=window.setInterval(this.animate.bind(this),this.step);return this},pause:function(){window.clearInterval(this.inProgress);this.inProgress=!1;return this},stop:function(){this.pause();this.indQueue=this.counter=0;this.queue[0]&& this.set(this.queue[0]);this.goTo(0);return this},clear:function(){this.pause();this.counter=this.indQueue=0;this.queue=[];this.to=this.from=!1;return this},add:function(a){this.queue.length===0&&this.set(a);this.queue.push(a);return this},go:function(a){this.inProgress||this.clear();this.add(a);this.inProgress||this.play();return this}};l&&this.anim.go(l);return this}; if(window.SVGTextElement&&window.SVGTextElement.prototype)window.SVGTextElement.prototype.cariTextAnim=function(l){if(this.cariAnim)if(this.textAnim)l&&this.textAnim.show(l);else{var j=this.getSVG(),f=this.firstChild.nodeValue,a=[],g=[],i=this,c=function(a,c){var h=i.cloneNode(!0);h.css("visibility","hidden");h.text.change(a);i.parentNode.appendChild(h);var e=i.cloneNode(!0);e.css("visibility","hidden");e.text.change(f.substr(0,c).replace(/ /g,"o"));j.appendChild(e);var k=e.getBBox().width;e.remove(); h.setAttribute("x",parseInt(h.getAttribute("x"),10)+k);g[c]=h};this.textAnim={letters:g,set:function(a){a&&!a.from&&(a={from:a});var a=a||{},c;for(c in a)a.hasOwnProperty(c)&&this.hasOwnProperty(c)&&(this[c]=a[c]);f=i.firstChild.nodeValue;a=i.getMtx();this.to={scaleX:a.getScaleX(),scaleY:a.getScaleY(),rotate:a.getAngle(),translateX:a.getX(),translateY:a.getY()}},from:{scale:10,scaleX:1,scaleY:1,rotate:0,translateX:0,translateY:0},to:!1,delay:300,duration:300,style:"swing",callback:!1,callbackLetter:!1, showLetter:function(a,c){var f=this;a.transf.translate(this.from.translateX||0,this.from.translateY||0).scale(this.from.scale||1).scaleNonUniform(this.from.scaleX||1,this.from.scaleY||1).rotate(this.from.rotate||0);a.css("visibility","visible");a.cariAnim({to:this.to,duration:this.duration,style:this.style,callback:function(){f.callbackLetter&&f.callbackLetter.call(i,a);c&&c===g.length-1&&f.callback&&f.callback.call(i)}})},hideLetter:function(a,c){var f=this;a.transf.translate(this.to.translateX|| 0,this.to.translateY||0).scale(this.to.scale||1).rotate(this.to.rotate||0);a.css("visibility","visible");a.cariAnim({to:this.from,duration:this.duration,style:this.style,callback:function(){a.remove();g.remove(a);c!==void 0&&c===0&&f.callback&&f.callback.call(i)}})},show:function(b){this.clear();this.set(b);var d=0,h=this;i.css("visibility","hidden");f.forEach(c);g.forEach(function(b,c){b.css("visibility","hidden");a.push(window.setTimeout(function(){h.showLetter(b,c)},d));d+=h.delay});return this}, hide:function(b){this.clear();this.set(b);var d=0,h=this;i.css("visibility","hidden");f.forEach(c);g.reverse().forEach(function(b,c){b.css("visibility","visible");a.push(window.setTimeout(function(){h.hideLetter(b,c)},d));d+=h.delay});return this},clear:function(){a.forEach(function(a){window.clearTimeout(a)});a=[];g.forEach(function(a){a.remove()});g=[];i.css("visibility","visible");return this},change:function(b,d){if(b!==f){this.clear();this.set(d);f.forEach(c);i.css("visibility","hidden");i.text.change(b); for(var h,e=f,j=0,l=!1,q=this;b.length<f.length;)h=g[f.length-1],h.remove(),g.remove(h),f=f.substr(0,f.length-1);f=b;b.forEach(function(b,d){e[d]===void 0||b!=e[d]?(e[d]!==void 0&&g[d].remove(),c(b,d),a.push(window.setTimeout(function(){q.showLetter(g[d])},j)),j+=q.delay,l=!0):(l&&(g[d].remove(),c(b,d)),g[d].css("visibility","visible"))});return this}}};l&&this.textAnim.show(l);return this}else alert("You must include the CariAnim module")}; if(window.SVGSVGElement&&window.SVGSVGElement.prototype)window.SVGSVGElement.prototype.cariSelect=function(l){var j=this;this.select={id:"selection",click:"left",key:!1,rect:!1,className:"selected",selected:[],selectedOld:[],deselected:[],callback:{selected:function(){},deselected:function(){}},list:[],start:!1,drag:!1,end:!1,set:function(f){for(var a in f)f.hasOwnProperty(a)&&this.hasOwnProperty(a)&&(this[a]=f[a])},mousedown:function(f){var a=this,g=typeof this.list=="string"?document.querySelectorAll(this.list): this.list,i=(f.button==2&&this.click=="right"||f.button!=2&&this.click=="left")&&(!this.key||f[this.key]);g.forEach(function(b){b.classList.remove(a.className)});this.rect&&this.rect.parentNode&&this.rect.remove();var c=function(){a.rect&&a.rect.parentNode&&a.rect.remove();g.forEach(function(b){b.className!==void 0&&(b.classList.contains(a.className)?a.selected.push(b):a.selectedOld.indexOf(b)!==-1&&a.deselected.push(b))});a.callback.selected.call(a,a.selected);a.callback.deselected.call(a,a.deselected); a.selectedOld=a.selected;a.selected=[];a.deselected=[];a.end&&i&&a.drag.call(a)};if(i){this.rect=j.addElmt("rect",{id:this.id,x:0,y:0,width:1,height:1});var b=j.point(f.clientX,f.clientY).matrixTransform(j.getScreenCTM().inverse());this.rect.transf.translate(parseInt(b.x,10),parseInt(b.y,10));this.rect.cariDrag?this.rect.cariDrag({resize:{click:this.click,key:this.key,keepRatio:!1,originX:0,originY:0,xmin:0,ymin:0,inverse:!0,start:this.start,end:c,drag:function(){var b=a.rect.getBoundingClientRect(); g.forEach(function(c){var e=c.getBoundingClientRect();e.left>=b.left&&e.left+e.width<=b.left+b.width&&e.top>=b.top&&e.top+e.height<=b.top+b.height?c.classList.contains(a.className)||c.classList.add(a.className):c.classList.remove(a.className)});a.drag&&a.drag.call(a)}},evt:f}):alert("You must include the CariDrag module")}else c()},on:function(f){if(f.callback&&!f.callback.selected)f.callback={selected:f.callback,deselected:function(){}};f&&this.set(f);var a=this.mousedown.bind(this);j.addEventListener("mousedown", a,!1);this.click=="right"&&j.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.off=function(){j.removeEventListener("mousedown",a,!1);return this};return this},off:function(){}};if(l)this.select.on(l);return this};